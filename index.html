<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liste de courses - bourogne</title>
    <style>
        @font-face {
            font-family: 'Benz Grotesk';
            src: url('Benz Grotesk.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Benz Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Helvetica Neue', sans-serif;
            background: #c8cede;
            min-height: 100vh;
            padding: 1rem;
        }

        p {
            font-family: 'Andale Mono', monospace;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .welcome-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .welcome-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 3rem;
            max-width: 500px;
            width: 100%;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 800;
            color: #2a432a;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .welcome-subtitle {
            color: #6b7280;
            font-size: 1.125rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.125rem;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }

        .input:focus {
            outline: none;
            border-color: #255825;
            box-shadow: 0 0 0 4px rgba(37, 88, 37, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            background: #2a432a;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            background-color: #1a1f1a;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            position: sticky;
            top: 1rem;
            z-index: 10;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 900;
            color: #111827;
        }

        .title-accent {
            color: #255825;
        }

        .user-greeting {
            color: #6b7280;
            font-weight: 500;
        }

        .user-name {
            color: #255825;
            font-weight: 600;
        }

        .sync-status {
            font-size: 0.75rem;
            color: #10b981;
            margin-top: 0.25rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            background: #e2e8f0;
            padding: 0.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: #4b5563;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #1f2937;
        }

        .tab.active {
            background: white;
            color: #255825;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* FIX: Formulaire d'ajout avec width 100% */
        .add-item-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
        }

        .add-item-form>* {
            min-width: 0;
            /* Emp√™che les d√©bordements */
        }

        .input-main {
            flex: 1;
            min-width: 0;
            padding: 1rem 1.25rem;
            background: #f1f5f9;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
        }

        .input-main:focus {
            outline: none;
            border-color: #255825;
            background: white;
        }

        .btn-primary {
            padding: 1rem 2rem;
            background: #255825;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 14px 0 rgba(37, 88, 37, 0.3);
            white-space: nowrap;
            /* Emp√™che le texte de se couper */
        }

        .btn-primary:hover {
            background: #1a3e1a;
            transform: translateY(-1px);
        }

        .add-recipe-form {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1rem;
        }

        .recipe-input-group {
            display: flex;
            gap: 0.5rem;
        }

        .zones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 1.5rem;
        }

        .zone-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .zone-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid;
            margin-bottom: 1rem;
        }

        .zone-fresh .zone-header {
            border-color: #d1fae5;
        }

        .zone-fresh-icon {
            background: #d1fae5;
        }

        .zone-sec .zone-header {
            border-color: #fef3c7;
        }

        .zone-sec-icon {
            background: #fef3c7;
        }

        .zone-icon {
            padding: 0.75rem;
            border-radius: 12px;
            font-size: 1.5rem;
        }

        .cold-icon {
            background: #dbeafe;
        }

        .dry-icon {
            background: #fef3c7;
        }

        .zone-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1f2937;
        }

        .zone-count {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .item-fresh {
            background: #d1fae5;
        }

        .item-fresh:hover {
            background: #a7f3d0;
        }

        .item-sec {
            background: #fef3c7;
        }

        .item-sec:hover {
            background: #fde68a;
        }

        .item-purchased {
            background: #d1fae5;
            opacity: 0.6;
        }

        /* Styles pour les suggestions intelligentes */
        .suggestion-alert {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 12px;
            animation: pulse 2s infinite;
        }

        .suggestion-urgent {
            background: #fee2e2;
            border: 2px solid #ef4444;
        }

        .suggestion-warning {
            background: #fff7ed;
            border: 2px solid #f97316;
        }

        .suggestion-info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .suggestion-urgent .suggestion-header {
            color: #dc2626;
        }

        .suggestion-warning .suggestion-header {
            color: #ea580c;
        }

        .suggestion-info .suggestion-header {
            color: #2563eb;
        }

        .suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .suggestion-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 999px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .suggestion-urgent .suggestion-btn {
            background: white;
            color: #dc2626;
            border: 1px solid #fca5a5;
        }

        .suggestion-warning .suggestion-btn {
            background: white;
            color: #ea580c;
            border: 1px solid #fdba74;
        }

        .suggestion-info .suggestion-btn {
            background: white;
            color: #2563eb;
            border: 1px solid #93c5fd;
        }

        .suggestion-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .suggestion-btn .priority-badge {
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: 999px;
            text-transform: uppercase;
        }

        .suggestion-urgent .priority-badge {
            background: #dc2626;
            color: white;
        }

        .suggestion-warning .priority-badge {
            background: #f97316;
            color: white;
        }

        /* Zone selector in form */
        .zone-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .inventory-inputs {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .inventory-inputs>* {
            flex: 1;
            min-width: 100px;
        }

        .inventory-quantity-inputs {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .inventory-quantity-inputs .input-main {
            flex: 1;
            min-width: 60px;
        }

        .zone-btn {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .zone-btn:hover {
            border-color: #9ca3af;
        }

        .zone-btn.active-fresh {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .zone-btn.active-sec {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        /* Inventory zone filter */
        .zone-filter {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .zone-filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: #f1f5f9;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .zone-filter-btn.active {
            background: #255825;
            color: white;
        }

        .expiry-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #92400e;
            margin-left: 0.5rem;
        }

        .stock-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .stock-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        .stock-bar-fill.high {
            background: #10b981;
        }

        .stock-bar-fill.medium {
            background: #f59e0b;
        }

        .stock-bar-fill.low {
            background: #ef4444;
        }

        .item-content {
            display: flex;
            gap: 0.75rem;
            flex: 1;
        }

        .checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .checkbox-checked {
            background: #10b981;
            border-color: #10b981;
            position: relative;
        }

        .checkbox-checked::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: -3px;
            left: 2px;
            font-size: 0.875rem;
        }

        .item-details {
            flex: 1;
            min-width: 0;
        }

        .item-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
            word-wrap: break-word;
        }

        .item-name-purchased {
            text-decoration: line-through;
            color: #6b7280;
        }

        .recipe-badge {
            font-size: 0.75rem;
            background: #dcfce7;
            color: #255825;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            margin-left: 0.5rem;
            white-space: nowrap;
        }

        .item-meta {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Category badges */
        .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-size: 0.6875rem;
            font-weight: 600;
            margin-left: 0.5rem;
            white-space: nowrap;
        }

        .category-fruits-legumes {
            background: #dcfce7;
            color: #166534;
        }

        .category-viandes-poissons {
            background: #fee2e2;
            color: #991b1b;
        }

        .category-produits-laitiers {
            background: #fef9c3;
            color: #854d0e;
        }

        .category-boulangerie {
            background: #fed7aa;
            color: #9a3412;
        }

        .category-boissons {
            background: #dbeafe;
            color: #1e40af;
        }

        .category-epicerie {
            background: #ffedd5;
            color: #9a3412;
        }

        .category-surgeles {
            background: #cffafe;
            color: #155e75;
        }

        .category-hygiene-maison {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .category-autre {
            background: #f1f5f9;
            color: #475569;
        }

        /* Category selector in form */
        .category-selector {
            display: flex;
            gap: 0.375rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 0.375rem 0.625rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Mobile responsive for category selector */
        @media (max-width: 768px) {
            .category-selector {
                gap: 0.25rem;
            }

            .category-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
        }

        .category-btn:hover {
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .category-btn.active {
            border-color: currentColor;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-btn.active[data-category="fruits-legumes"] {
            background: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }

        .category-btn.active[data-category="viandes-poissons"] {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .category-btn.active[data-category="produits-laitiers"] {
            background: #fef9c3;
            border-color: #eab308;
            color: #854d0e;
        }

        .category-btn.active[data-category="boulangerie"] {
            background: #fed7aa;
            border-color: #f97316;
            color: #9a3412;
        }

        .category-btn.active[data-category="boissons"] {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .category-btn.active[data-category="epicerie"] {
            background: #ffedd5;
            border-color: #fb923c;
            color: #9a3412;
        }

        .category-btn.active[data-category="surgeles"] {
            background: #cffafe;
            border-color: #06b6d4;
            color: #155e75;
        }

        .category-btn.active[data-category="hygiene-maison"] {
            background: #f3e8ff;
            border-color: #a855f7;
            color: #6b21a8;
        }

        .category-btn.active[data-category="autre"] {
            background: #f1f5f9;
            border-color: #64748b;
            color: #475569;
        }

        .purchased-info {
            font-size: 0.75rem;
            color: #10b981;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .btn-delete {
            color: #ef4444;
            background: transparent;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-qty {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            font-weight: bold;
            color: #255825;
            transition: all 0.2s;
        }

        .btn-qty:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .qty-value {
            font-weight: 700;
            font-size: 1.125rem;
            min-width: 1.5rem;
            text-align: center;
        }

        .low-stock-alert {
            background: #fee2e2;
            border: 2px solid #ef4444;
        }

        .alert-text {
            color: #ef4444;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .empty-state {
            color: #9ca3af;
            text-align: center;
            padding: 3rem 0;
        }

        .recipes-section {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .recipes-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .recipe-card {
            background: #dcfce7;
            border: 2px solid #bbf7d0;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .recipe-name {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1f2937;
        }

        .recipe-meta {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .ingredients-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .ingredients-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .ingredient-tag {
            background: white;
            padding: 0.5rem 0.75rem;
            border-radius: 999px;
            font-size: 0.875rem;
            border: 1px solid #bbf7d0;
        }

        .btn-add-ingredients {
            width: 100%;
            padding: 0.75rem;
            background: #255825;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add-ingredients:hover {
            background: #1a3e1a;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            color: #6b7280;
            padding: 2rem;
        }

        /* ========================================
   RESPONSIVE MOBILE
   ======================================== */

        @media (max-width: 768px) {
            body {
                padding: 0.75rem;
                font-size: 14px;
            }

            .container {
                padding: 0;
            }

            .welcome-screen {
                padding: 1rem;
            }

            .welcome-card {
                padding: 1.5rem;
                border-radius: 16px;
            }

            .welcome-title {
                font-size: 1.5rem;
            }

            .welcome-subtitle {
                font-size: 0.875rem;
            }

            .input {
                padding: 0.75rem;
                font-size: 1rem;
            }

            .header {
                padding: 1rem;
                position: relative;
                top: auto;
                border-radius: 16px;
                margin-bottom: 1rem;
            }

            .header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                margin-bottom: 1rem;
            }

            .app-title {
                font-size: 1.5rem;
                line-height: 1.2;
            }

            .title-accent {
                display: block;
            }

            .user-greeting {
                font-size: 0.875rem;
            }

            .sync-status {
                font-size: 0.625rem;
            }

            /* Tabs - plus compact sur mobile */
            .tabs {
                width: 100%;
                padding: 0.375rem;
                gap: 0.375rem;
            }

            .tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
                border-radius: 6px;
            }

            /* Formulaire d'ajout - colonne sur mobile */
            .add-item-form {
                flex-direction: column;
                gap: 0.5rem;
            }

            .input-main {
                width: 100%;
                padding: 0.75rem 1rem;
                font-size: 1rem;
            }

            .btn-primary {
                width: 100%;
                padding: 0.75rem 1rem;
                font-size: 1rem;
            }

            /* Formulaire de recette */
            .add-recipe-form {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .recipe-input-group {
                flex-direction: column;
            }

            /* Zone selector dans le formulaire d'inventaire */
            .zone-selector {
                width: 100%;
            }

            .zone-btn {
                padding: 0.625rem 0.5rem;
                font-size: 0.8125rem;
            }

            /* Suggestions */
            .suggestion-alert {
                padding: 0.75rem;
            }

            .suggestion-list {
                gap: 0.375rem;
            }

            .suggestion-btn,
            .ingredient-tag {
                padding: 0.375rem 0.625rem;
                font-size: 0.75rem;
            }

            /* Grid des zones - une seule colonne */
            .zones-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .zone-card {
                padding: 1rem;
                border-radius: 16px;
            }

            .zone-header {
                padding-bottom: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .zone-icon {
                padding: 0.5rem;
                font-size: 1.25rem;
            }

            .zone-title {
                font-size: 1rem;
            }

            .zone-count {
                font-size: 0.75rem;
            }

            /* Items */
            .item {
                padding: 0.75rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .item-content {
                flex: 1;
                min-width: 0;
            }

            .item-details {
                flex: 1;
            }

            .item-name {
                font-size: 0.9375rem;
            }

            .item-meta {
                font-size: 0.6875rem;
            }

            .recipe-badge {
                font-size: 0.625rem;
                padding: 0.125rem 0.375rem;
                margin-left: 0.25rem;
            }

            .checkbox {
                width: 1.125rem;
                height: 1.125rem;
            }

            /* Quantity controls */
            .quantity-controls {
                gap: 0.375rem;
            }

            .btn-qty {
                width: 28px;
                height: 28px;
                font-size: 1rem;
            }

            .qty-value {
                font-size: 1rem;
                min-width: 1.25rem;
            }

            .btn-delete {
                padding: 0.375rem;
                font-size: 0.875rem;
            }

            /* Recettes */
            .recipes-section {
                padding: 1rem;
                border-radius: 16px;
            }

            .recipes-title {
                font-size: 1.25rem;
                margin-bottom: 0.75rem;
            }

            .recipe-card {
                padding: 1rem;
                border-radius: 12px;
            }

            .recipe-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .recipe-name {
                font-size: 1rem;
            }

            .recipe-meta {
                font-size: 0.6875rem;
            }

            .ingredients-label {
                font-size: 0.75rem;
            }

            .ingredients-tags {
                gap: 0.375rem;
            }

            .ingredient-tag {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }

            .btn-add-ingredients {
                padding: 0.625rem;
                font-size: 0.875rem;
            }

            /* Inventaire - filtre */
            .zone-filter {
                gap: 0.375rem;
            }

            .zone-filter-btn {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }

            /* Inventory form inputs - mobile */
            .inventory-inputs {
                flex-direction: column;
            }

            .inventory-inputs>* {
                width: 100%;
                min-width: 0;
            }

            .inventory-quantity-inputs {
                flex-wrap: wrap;
            }

            .inventory-quantity-inputs .input-main {
                min-width: 80px;
                flex: 1 1 calc(33.333% - 0.5rem);
            }

            /* Stock alerts */
            .alert-text {
                font-size: 0.6875rem;
            }

            .low-stock-alert {
                padding: 0.5rem;
            }

            /* Import button */
            #importBtn {
                font-size: 0.6875rem;
                padding: 0.25rem 0.5rem;
            }

            /* Empty states */
            .empty-state {
                padding: 2rem 0;
                font-size: 0.875rem;
            }

            .loading {
                padding: 1.5rem;
                font-size: 0.875rem;
            }
        }

        /* Tr√®s petits √©crans */
        @media (max-width: 360px) {
            body {
                padding: 0.5rem;
            }

            .app-title {
                font-size: 1.25rem;
            }

            .welcome-title {
                font-size: 1.25rem;
            }

            .welcome-card {
                padding: 1.25rem;
            }

            .header {
                padding: 0.75rem;
            }

            .tab {
                padding: 0.375rem 0.5rem;
                font-size: 0.6875rem;
            }

            .input,
            .input-main {
                font-size: 0.9375rem;
                padding: 0.625rem 0.75rem;
            }

            .btn,
            .btn-primary {
                font-size: 0.9375rem;
                padding: 0.625rem 0.75rem;
            }

            .item {
                padding: 0.5rem;
            }

            .item-name {
                font-size: 0.875rem;
            }

            .zone-card {
                padding: 0.75rem;
            }
        }

        /* Support pour les √©cransavec encoche (notch) */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: max(0.75rem, env(safe-area-inset-top));
                padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
                padding-left: max(0.75rem, env(safe-area-inset-left));
                padding-right: max(0.75rem, env(safe-area-inset-right));
            }

            .header {
                padding-top: max(1rem, env(safe-area-inset-top));
            }
        }

        /* Mode paysage sur mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .welcome-screen {
                min-height: auto;
                padding: 1rem 0;
            }

            .welcome-card {
                padding: 1rem;
                max-width: 400px;
            }

            .header {
                position: relative;
                top: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Main App (no welcome screen) -->
    <div id="mainApp" class="container">
        <div class="header">
            <div class="header-top">
                <div>
                    <h1 class="app-title">Les Courses <span class="title-accent">de Janvier</span></h1>
                    <p class="user-greeting">Bonjour, <span class="user-name" id="userName">@User</span> üëã</p>
                    <p class="sync-status" id="syncStatus">üîÑ Connexion √† Firebase...</p>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchTab('liste')">üõí Liste</button>
                    <button class="tab" onclick="switchTab('recettes')">üë®‚Äçüç≥ Recettes</button>
                    <button class="tab" onclick="switchTab('inventaire')">üè† Inventaire</button>
                </div>
            </div>

            <!-- Add Item Form -->
            <div id="addItemForm" class="add-item-form">
                <div class="category-selector" id="categorySelector">
                    <button type="button" class="category-btn active" data-category="autre"
                        onclick="selectCategory('autre')">üì¶</button>
                    <button type="button" class="category-btn" data-category="fruits-legumes"
                        onclick="selectCategory('fruits-legumes')">üçé</button>
                    <button type="button" class="category-btn" data-category="viandes-poissons"
                        onclick="selectCategory('viandes-poissons')">ü•©</button>
                    <button type="button" class="category-btn" data-category="produits-laitiers"
                        onclick="selectCategory('produits-laitiers')">üßà</button>
                    <button type="button" class="category-btn" data-category="boulangerie"
                        onclick="selectCategory('boulangerie')">üçû</button>
                    <button type="button" class="category-btn" data-category="boissons"
                        onclick="selectCategory('boissons')">ü•§</button>
                    <button type="button" class="category-btn" data-category="epicerie"
                        onclick="selectCategory('epicerie')">üçù</button>
                    <button type="button" class="category-btn" data-category="surgeles"
                        onclick="selectCategory('surgeles')">üßä</button>
                    <button type="button" class="category-btn" data-category="hygiene-maison"
                        onclick="selectCategory('hygiene-maison')">üßπ</button>
                </div>
                <input type="text" id="newItem" class="input-main" placeholder="Ajouter...">
                <button class="btn-primary" onclick="addItem()">+ Ajouter</button>
            </div>

            <!-- Add Recipe Form -->
            <div id="addRecipeForm" class="add-recipe-form hidden">
                <input type="text" id="recipeName" class="input-main" placeholder="Nom de la recette...">
                <div class="recipe-input-group">
                    <input type="text" id="recipeIngredients" class="input-main"
                        placeholder="Ingr√©dients (s√©par√©s par des virgules)...">
                    <button class="btn-primary" onclick="addRecipe()">+</button>
                </div>
            </div>

            <!-- Add Inventory Form -->
            <div id="addInventoryForm" class="hidden">
                <div class="add-item-form" style="flex-direction: column;">
                    <div class="zone-selector">
                        <button type="button" class="zone-btn active-fresh" onclick="selectInventoryZone('frais')"
                            id="zoneFraisBtn">
                            ‚ùÑÔ∏è Frais
                        </button>
                        <button type="button" class="zone-btn" onclick="selectInventoryZone('sec')" id="zoneSecBtn">
                            üì¶ Sec
                        </button>
                    </div>
                    <div class="inventory-inputs">
                        <input type="text" id="newInventoryItem" class="input-main" placeholder="Nom de l'article...">
                        <div class="inventory-quantity-inputs">
                            <input type="number" id="inventoryQuantity" class="input-main" placeholder="Qt√©" value="1">
                            <input type="number" id="inventoryThreshold" class="input-main" placeholder="Seuil"
                                value="1">
                            <select id="inventoryUnit" class="input-main unit-select">
                                <option value="pcs">pcs</option>
                                <option value="L">Litre(s)</option>
                                <option value="kg">kg</option>
                                <option value="g">g</option>
                                <option value="ml">ml</option>
                                <option value="bouteille">bouteille(s)</option>
                                <option value="bo√Æte">bo√Æte(s)</option>
                                <option value="pot">pot(s)</option>
                                <option value="sachet">sachet(s)</option>
                                <option value="paquet">paquet(s)</option>
                                <option value="rouleau">rouleau(x)</option>
                                <option value="barquette">barquette(s)</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="addInventoryItem()">Ajouter</button>
                    </div>
                </div>
            </div>

            <!-- Suggestions Stock -->
            <div id="stockSuggestions" class="hidden"
                style="margin-top: 1rem; padding: 1rem; background: #fffbeb; border: 1px solid #fcd34d; border-radius: 12px;">
                <p
                    style="font-weight: 700; color: #92400e; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    üí° Suggestions de rachat (stock bas)
                </p>
                <div id="suggestionsList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
            </div>
        </div>

        <!-- Liste Tab -->
        <div id="listeTab" class="zones-grid">
            <div class="zone-card zone-fresh">
                <div class="zone-header">
                    <div class="zone-icon zone-fresh-icon">‚ùÑÔ∏è</div>
                    <div>
                        <h2 class="zone-title">Espace Frais</h2>
                        <p class="zone-count" id="freshCount">0 article(s)</p>
                    </div>
                </div>
                <div id="freshItems" class="items-list">
                    <p class="loading">Chargement...</p>
                </div>
            </div>

            <div class="zone-card zone-sec">
                <div class="zone-header">
                    <div class="zone-icon zone-sec-icon">üì¶</div>
                    <div>
                        <h2 class="zone-title">Espace Sec</h2>
                        <p class="zone-count" id="secCount">0 article(s)</p>
                    </div>
                </div>
                <div id="secItems" class="items-list">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
        </div>

        <!-- Recettes Tab -->
        <div id="recettesTab" class="recipes-section hidden">
            <h2 class="recipes-title">üë®‚Äçüç≥ Recettes de la Semaine</h2>
            <div id="recipesList">
                <p class="loading">Chargement...</p>
            </div>
        </div>

        <!-- Inventaire Tab -->
        <div id="inventaireTab" class="zones-grid hidden">
            <div class="zone-card" style="grid-column: 1 / -1;">
                <div class="zone-header">
                    <div class="zone-icon zone-sec-icon">üè†</div>
                    <div>
                        <h2 class="zone-title">Stock Maison</h2>
                        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <p class="zone-count" id="inventoryCount">0 article(s)</p>
                            <button id="importBtn" class="recipe-badge hidden" style="border: none; cursor: pointer;"
                                onclick="importInitialInventory()">üì• Importer liste initiale</button>
                        </div>
                    </div>
                </div>

                <!-- Zone Filter -->
                <div class="zone-filter">
                    <button class="zone-filter-btn active" onclick="filterInventory('all')" id="filterAll">Tous</button>
                    <button class="zone-filter-btn" onclick="filterInventory('frais')" id="filterFrais">‚ùÑÔ∏è
                        Frais</button>
                    <button class="zone-filter-btn" onclick="filterInventory('sec')" id="filterSec">üì¶ Sec</button>
                </div>

                <div id="inventoryList" class="items-list">
                    <p class="loading">Chargement...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase FIRESTORE (pas Realtime Database) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBpuW5lQFSfZmp-2pD09_LwkoMisY7VKd0",
            authDomain: "liste-de-course-b82b2.firebaseapp.com",
            projectId: "liste-de-course-b82b2",
            storageBucket: "liste-de-course-b82b2.firebasestorage.app",
            messagingSenderId: "539699514303",
            appId: "1:539699514303:web:6202aa05293adf07952f0a",
            measurementId: "G-1BTQBQLFV0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        console.log('üî• Firebase Firestore initialis√©');

        // Variables globales
        let items = [];
        let recipes = [];
        let inventory = [];
        let userName = 'Moi';
        let activeTab = 'liste';
        let selectedCategory = 'autre';

        // Cat√©gories avec leurs mots-cl√©s pour d√©tection automatique
        const categoryKeywords = {
            'fruits-legumes': ['pomme', 'banane', 'orange', 'fraise', 'raisin', 'tomate', 'salade', 'l√©gume', 'carotte', 'oignon', 'patate', 'poireau', 'brocoli', 'poivron', 'concombre', 'aubergine', 'courgette', 'fruits', 'abricot', 'p√™che', 'prune', 'cerise', 'melon', 'past√®que', 'kiwi', 'citron', 'mandarine', 'noix', 'amande', 'noisette'],
            'viandes-poissons': ['viande', 'poulet', 'boeuf', 'porc', 'agneau', 'poisson', 'saumon', 'thon', 'cabillaud', 'merlan', 'jambon', 'saucisse', 'steak', 'c√¥telette', 'escalope', 'dinde', 'veau', 'lapin', 'crevette', 'moule', 'hu√Ætre', 'crabe', 'langoustine', 'sardine', 'anchois', 'hareng'],
            'produits-laitiers': ['lait', 'fromage', 'beurre', 'yaourt', 'cr√®me', 'oeuf', 'oeufs', 'yaourt', 'fromage blanc', 'petit suisse', 'mascarpone', 'mozzarella', 'comt√©', 'gruy√®re', 'emmental', 'roquefort', 'ch√®vre', 'bleu', 'saint-nectaire', 'tomme', 'ricotta', 'feta'],
            'boulangerie': ['pain', 'baguette', 'croissant', 'pain au chocolat', '√©clair', 'tarte', 'brioche', 'biscotte', 'pain de mie', 'galette', 'cr√™pe', 'g√¢teau', 'madeleine', 'cookie', 'muffin', 'cake', 'pain aux raisins'],
            'boissons': ['eau', 'jus', 'soda', 'caf√©', 'th√©', 'vin', 'bi√®re', 'sirop', 'lait', 'chocolate', 'smoothie', 'limonade', 'cola', 'citronnade', 'tonic', 'schweppes', 'cappuccino', 'expresso'],
            'epicerie': ['p√¢tes', 'riz', 'farine', 'sucre', 'sel', 'huile', 'vinaigre', 'sauce', 'conserve', 'thon', 'sardine', 'haricot', 'lentille', 'pois', '√©picerie', '√©pice', 'bouillon', 'cube', 'poudre', 'chocolate', 'c√©r√©ale', 'muesli', 'flocon', 'poudre', 'levure'],
            'surgeles': ['surgel√©', 'glace', 'pizza', 'poisson surgel√©', 'legume surgel√©', 'frites', 'chips', 'stick', 'b√¢tonnet', 'barre glac√©e', 'sorbet'],
            'hygiene-maison': ['savon', 'shampooing', 'dentifrice', 'brosse √† dents', 'papier', 'toinette', 'lessive', 'adoucissant', 'nettoyant', 'd√©sinfectant', 'spray', '√©ponge', 'sac poubelle', 'rouleau', 'coton', 'compresse', 'bandage', 'doliprane', 'm√©dicament']
        };

        const categoryIcons = {
            'fruits-legumes': 'üçé',
            'viandes-poissons': 'ü•©',
            'produits-laitiers': 'üßà',
            'boulangerie': 'üçû',
            'boissons': 'ü•§',
            'epicerie': 'üçù',
            'surgeles': 'üßä',
            'hygiene-maison': 'üßπ',
            'autre': 'üì¶'
        };

        // Fonction pour d√©tecter automatiquement la cat√©gorie
        function detectCategory(itemName) {
            const lowerName = itemName.toLowerCase();
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                if (keywords.some(keyword => lowerName.includes(keyword))) {
                    return category;
                }
            }
            return 'autre';
        }

        // Fonction pour s√©lectionner une cat√©gorie
        window.selectCategory = function (category) {
            selectedCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
        };

        const coldItems = ['lait', 'beurre', 'fromage', 'yaourt', 'cr√®me', 'viande', 'poisson', 'jambon', 'saumon', 'poulet', 'boeuf', 'porc', 'l√©gumes frais', 'salade', 'tomate', 'concombre', 'carotte', 'fruits frais', 'pomme', 'orange', 'banane', 'raisin', 'fraise'];
        const dryItems = ['oeufs', 'oeuf', 'p√¢tes', 'riz', 'farine', 'sucre', 'sel', 'poivre', 'huile', 'vinaigre', 'conserve', 'thon', 'c√©r√©ales', 'pain', 'biscuit', 'chocolat', 'caf√©', 'th√©', 'sauce', '√©pices', 'miel', 'confiture'];

        // √âcouter les changements en temps r√©el avec Firestore
        const itemsQuery = query(collection(db, 'grocery-items'), orderBy('timestamp', 'desc'));
        const recipesQuery = query(collection(db, 'grocery-recipes'), orderBy('timestamp', 'desc'));
        const inventoryQuery = query(collection(db, 'inventory-items'), orderBy('name', 'asc'));

        onSnapshot(itemsQuery, (snapshot) => {
            items = [];
            snapshot.forEach((doc) => {
                items.push({ id: doc.id, ...doc.data() });
            });
            console.log('üì¶ Articles mis √† jour:', items.length);
            renderItems();
            updateSuggestions();
            document.getElementById('syncStatus').textContent = 'üåê Synchronis√© en temps r√©el';
        }, (error) => {
            console.error('‚ùå Erreur connexion items:', error);
            document.getElementById('syncStatus').textContent = '‚ùå Erreur de connexion';
        });

        onSnapshot(recipesQuery, (snapshot) => {
            recipes = [];
            snapshot.forEach((doc) => {
                recipes.push({ id: doc.id, ...doc.data() });
            });
            console.log('üç≥ Recettes mises √† jour:', recipes.length);
            renderRecipes();
        }, (error) => {
            console.error('‚ùå Erreur connexion recettes:', error);
        });

        onSnapshot(inventoryQuery, (snapshot) => {
            inventory = [];
            snapshot.forEach((doc) => {
                inventory.push({ id: doc.id, ...doc.data() });
            });
            console.log('üè† Inventaire mis √† jour:', inventory.length);

            // Auto-import si inventaire vide
            if (inventory.length === 0) {
                console.log('üì• Inventaire vide, lancement de l\'import...');
                importInitialInventory();
            } else {
                renderInventory();
            }
        }, (error) => {
            console.error('‚ùå Erreur connexion inventaire:', error);
        });

        // Auto-afficher l'app directement
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('userName').textContent = '@' + userName;

        function determineZone(itemName) {
            const lowerName = itemName.toLowerCase();
            if (coldItems.some(cold => lowerName.includes(cold))) return 'froid';
            if (dryItems.some(dry => lowerName.includes(dry))) return 'placard';
            return 'placard';
        }

        window.addItem = async function () {
            const input = document.getElementById('newItem');
            const itemName = input.value.trim();

            if (!userName) {
                alert('Veuillez entrer votre pr√©nom d\'abord!');
                return;
            }

            if (!itemName) {
                input.style.borderColor = '#ef4444';
                input.focus();
                setTimeout(() => input.style.borderColor = '', 2000);
                return;
            }

            // V√©rifier l'inventaire
            const inventoryItem = inventory.find(i => i.name.toLowerCase() === itemName.toLowerCase());
            if (inventoryItem && inventoryItem.quantity > inventoryItem.threshold) {
                if (!confirm(`Vous avez d√©j√† ${inventoryItem.quantity} "${itemName}" en stock (seuil: ${inventoryItem.threshold}). Ajouter quand m√™me ?`)) {
                    return;
                }
            }

            const item = {
                name: itemName,
                zone: determineZone(itemName),
                category: selectedCategory,
                addedBy: userName,
                timestamp: new Date(),
                timestampDisplay: new Date().toLocaleString('fr-FR'),
                purchased: false,
                purchasedBy: null,
                purchasedAt: null
            };

            try {
                await addDoc(collection(db, 'grocery-items'), item);
                input.value = '';
                // Feedback visuel
                input.placeholder = '‚úì!';
                setTimeout(() => {
                    input.placeholder = "Ajouter...";
                }, 1500);
                console.log('‚úÖ Article ajout√©');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                alert('Erreur lors de l\'ajout: ' + error.message);
            }
        };

        window.addRecipe = async function () {
            const nameInput = document.getElementById('recipeName');
            const ingredientsInput = document.getElementById('recipeIngredients');

            const name = nameInput.value.trim();
            const ingredients = ingredientsInput.value.trim();

            // Validation avec feedback utilisateur
            if (!userName) {
                alert('Veuillez entrer votre pr√©nom d\'abord!');
                return;
            }

            if (!name) {
                nameInput.style.borderColor = '#ef4444';
                nameInput.focus();
                setTimeout(() => nameInput.style.borderColor = '', 2000);
                return;
            }

            if (!ingredients) {
                ingredientsInput.style.borderColor = '#ef4444';
                ingredientsInput.focus();
                setTimeout(() => ingredientsInput.style.borderColor = '', 2000);
                return;
            }

            const recipe = {
                name: name,
                ingredients: ingredients.split(',').map(i => i.trim()).filter(i => i),
                addedBy: userName,
                timestamp: new Date(),
                timestampDisplay: new Date().toLocaleString('fr-FR')
            };

            try {
                await addDoc(collection(db, 'grocery-recipes'), recipe);
                nameInput.value = '';
                ingredientsInput.value = '';
                // Feedback visuel de succ√®s
                const btn = document.querySelector('#addRecipeForm .btn-primary');
                btn.textContent = '‚úì Ajout√©!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.textContent = '+';
                    btn.style.background = '';
                }, 1500);
                console.log('‚úÖ Recette ajout√©e');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                alert('Erreur lors de l\'ajout: ' + error.message);
            }
        };

        window.togglePurchased = async function (id) {
            const item = items.find(i => i.id === id);
            if (item) {
                const newPurchasedState = !item.purchased;

                try {
                    await updateDoc(doc(db, 'grocery-items', id), {
                        purchased: newPurchasedState,
                        purchasedBy: newPurchasedState ? userName : null,
                        purchasedAt: newPurchasedState ? new Date().toLocaleString('fr-FR') : null
                    });

                    // Si l'article est coch√© comme achet√©, l'ajouter au stock
                    if (newPurchasedState) {
                        await addToInventoryFromPurchase(item);
                    }
                } catch (error) {
                    console.error('‚ùå Erreur:', error);
                }
            }
        };

        // Ajouter automatiquement au stock quand un article est achet√©
        async function addToInventoryFromPurchase(item) {
            console.log('üì• Ajout au stock:', item.name);

            // V√©rifier si l'article existe d√©j√† dans l'inventaire
            const existingItem = inventory.find(i =>
                i.name.toLowerCase() === item.name.toLowerCase()
            );

            if (existingItem) {
                // Augmenter la quantit√©
                const newQty = (existingItem.quantity || 0) + 1;
                await updateDoc(doc(db, 'inventory-items', existingItem.id), {
                    quantity: newQty
                });
                console.log('‚úÖ Quantit√© mise √† jour:', newQty);
                alert(`üì¶ "${item.name}" ajout√© au stock (${newQty})`);
            } else {
                // Cr√©er un nouvel article dans l'inventaire
                await addDoc(collection(db, 'inventory-items'), {
                    name: item.name,
                    quantity: 1,
                    threshold: 1,
                    unit: 'pcs',
                    zone: item.zone || determineZone(item.name),
                    category: item.category || detectCategory(item.name),
                    timestamp: new Date()
                });
                console.log('‚úÖ Nouvel article cr√©√© dans le stock');
                alert(`üì¶ "${item.name}" ajout√© au stock (1)`);
            }
        }

        window.deleteItem = async function (id) {
            try {
                await deleteDoc(doc(db, 'grocery-items', id));
                console.log('‚úÖ Article supprim√©');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        };

        window.deleteRecipe = async function (id) {
            try {
                await deleteDoc(doc(db, 'grocery-recipes', id));
                console.log('‚úÖ Recette supprim√©e');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        };

        window.addInventoryItem = async function () {
            const input = document.getElementById('newInventoryItem');
            const thresholdInput = document.getElementById('inventoryThreshold');
            const quantityInput = document.getElementById('inventoryQuantity');
            const unitSelect = document.getElementById('inventoryUnit');

            const itemName = input.value.trim();
            const threshold = parseInt(thresholdInput.value) || 1;
            const quantity = parseInt(quantityInput.value) || threshold;
            const unit = unitSelect.value;

            if (!userName) {
                alert('Veuillez entrer votre pr√©nom d\'abord!');
                return;
            }

            if (!itemName) {
                input.style.borderColor = '#ef4444';
                input.focus();
                setTimeout(() => input.style.borderColor = '', 2000);
                return;
            }

            const item = {
                name: itemName,
                quantity: quantity,
                threshold: threshold,
                unit: unit,
                zone: determineZone(itemName),
                timestamp: new Date()
            };

            try {
                await addDoc(collection(db, 'inventory-items'), item);
                input.value = '';
                // Reset values
                quantityInput.value = '1';
                thresholdInput.value = '1';
                unitSelect.value = 'pcs';

                // Feedback visuel
                input.placeholder = '‚úì Ajout√©!';
                setTimeout(() => {
                    input.placeholder = "Nom de l'article...";
                }, 1500);
                console.log('‚úÖ Article d\'inventaire ajout√©');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                alert('Erreur lors de l\'ajout: ' + error.message);
            }
        };

        window.updateInventoryQuantity = async function (id, delta) {
            const item = inventory.find(i => i.id === id);
            if (item) {
                const newQty = Math.max(0, (item.quantity || 0) + delta);
                try {
                    await updateDoc(doc(db, 'inventory-items', id), {
                        quantity: newQty
                    });
                } catch (error) {
                    console.error('‚ùå Erreur:', error);
                }
            }
        };

        window.deleteInventoryItem = async function (id) {
            try {
                await deleteDoc(doc(db, 'inventory-items', id));
                console.log('‚úÖ Article d\'inventaire supprim√©');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        };

        window.importInitialInventory = async function () {
            const initialInventory = [
                { name: "Levure boulang√®re", quantity: 2, threshold: 1, unit: "sachets" },
                { name: "Sucre glace", quantity: 300, threshold: 500, unit: "g" },
                { name: "Nesquik", quantity: 150, threshold: 350, unit: "g" },
                { name: "Sucre en poudre blanc", quantity: 1000, threshold: 500, unit: "g" },
                { name: "Farine", quantity: 200, threshold: 1000, unit: "g" },
                { name: "Caf√© moulu Arabica", quantity: 200, threshold: 200, unit: "g" },
                { name: "Th√© fraise et menthe", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Th√© au thym (2 Marmottes)", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Th√© thym en feuille", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Th√© Celestial Fruits rouges", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Th√© vert et menthe", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Amandes effil√©es", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Th√© verveine menthe", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Beurre de cacahu√®tes", quantity: 1, threshold: 1, unit: "pot" },
                { name: "Confitures rouges", quantity: 7, threshold: 2, unit: "pots" },
                { name: "Sucre de canne", quantity: 250, threshold: 500, unit: "g" },
                { name: "P√¢te √† tartiner noisette", quantity: 3, threshold: 1, unit: "pots" },
                { name: "Jus de citron", quantity: 0, threshold: 1, unit: "bouteille" },
                { name: "M√©lange graines et raisins", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Cookies", quantity: 2, threshold: 2, unit: "pi√®ces" },
                { name: "G√¢teaux travail (Choco/Fraise)", quantity: 2, threshold: 1, unit: "bo√Ætes" },
                { name: "Dattes", quantity: 2, threshold: 1, unit: "sachets" },
                { name: "Ananas en conserve", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Mangue en tranche conserve", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Dahl de lentille (sachet midi)", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Riz fa√ßon basquaise", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Paella (sachet)", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Crousti pan√© v√©g√©tal", quantity: 1, threshold: 1, unit: "bo√Æte" },
                { name: "Tartine de sarrasin", quantity: 1, threshold: 1, unit: "paquet" },
                { name: "M√©lange c√©r√©ales bio / l√©gumes secs", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "F√©cule bio", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "P√¢tes (fond)", quantity: 100, threshold: 500, unit: "g" },
                { name: "Long riz (1 pers)", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Lentilles corail (fond)", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Lentilles bocal (2028)", quantity: 1, threshold: 1, unit: "bocal" },
                { name: "Sirop", quantity: 1, threshold: 1, unit: "bouteille" },
                { name: "Huile d'olive", quantity: 1, threshold: 1, unit: "bouteille" },
                { name: "Oignon frit", quantity: 1, threshold: 1, unit: "sachet" },
                { name: "Vinaigre balsamique", quantity: 1, threshold: 1, unit: "bouteille" },
                { name: "P√¢te √† lasagne", quantity: 1, threshold: 1, unit: "paquet" },
                { name: "Biscotte", quantity: 1, threshold: 1, unit: "paquet" },
                { name: "Cr√®me de soja cuisine", quantity: 0, threshold: 1, unit: "bouteille" },
                { name: "Bouillon de l√©gume (cubes)", quantity: 3, threshold: 6, unit: "cubes" },
                { name: "Nouilles", quantity: 0, threshold: 1, unit: "paquet" },
                { name: "Papier aluminium", quantity: 1, threshold: 1, unit: "rouleau" },
                { name: "Papier sulfuris√©", quantity: 0, threshold: 1, unit: "rouleau" }
            ];

            const btn = document.getElementById('importBtn');
            btn.disabled = true;
            btn.textContent = "‚åõ Import en cours...";

            for (const item of initialInventory) {
                const docData = {
                    ...item,
                    zone: 'placard', // All provided items were for dry storage
                    timestamp: new Date()
                };
                try {
                    await addDoc(collection(db, 'inventory-items'), docData);
                } catch (error) {
                    console.error(`‚ùå Erreur pour ${item.name}:`, error);
                }
            }



            // Forcer le rafra√Æchissement de l'inventaire
            setTimeout(() => {
                // Recharger depuis Firebase
                getDocs(inventoryQuery).then((snapshot) => {
                    inventory = [];
                    snapshot.forEach((doc) => {
                        inventory.push({ id: doc.id, ...doc.data() });
                    });
                    renderInventory();
                });
                alert('‚úÖ Inventaire initial import√© avec succ√®s !');
            }, 1000);
        };
        // Articles non-vitaux (toujours OK m√™me si stock bas)
        const nonVitalItems = ['th√©', 'the', 'caf√©', 'cafe', 'tisane', 'infusion'];

        function renderInventory() {
            const container = document.getElementById('inventoryList');
            document.getElementById('inventoryCount').textContent = inventory.length + ' article(s)';

            // Apply filter
            let filteredInventory = inventory.filter(item => {
                if (currentInventoryFilter === 'all') return true;
                if (currentInventoryFilter === 'frais') return item.zone === 'froid';
                if (currentInventoryFilter === 'sec') return item.zone === 'placard';
                return true;
            });

            if (filteredInventory.length === 0) {
                container.innerHTML = '<p class="empty-state">Aucun article en stock</p>';
                return;
            }

            // V√©rifier si article non-vital
            function isNonVital(name) {
                return nonVitalItems.some(item => name.toLowerCase().includes(item));
            }

            // S√©parer en cat√©gories
            const lowStock = filteredInventory.filter(item => item.quantity <= item.threshold && !isNonVital(item.name));
            const goodStock = filteredInventory.filter(item => item.quantity > item.threshold || isNonVital(item.name));
            const emptyStock = filteredInventory.filter(item => item.quantity === 0 && !isNonVital(item.name));

            let html = '';

            // Section: Rupture (0)
            if (emptyStock.length > 0) {
                html += `
                    <div class="inventory-section">
                        <h3 class="section-title" style="color: #ef4444; margin: 1rem 0 0.5rem 0;">‚ö†Ô∏è Rupture (${emptyStock.length})</h3>
                        ${emptyStock.map(item => createInventoryItemHTML(item)).join('')}
                    </div>
                `;
            }

            // Section: Bient√¥t en rupture
            if (lowStock.length > 0) {
                html += `
                    <div class="inventory-section">
                        <h3 class="section-title" style="color: #f97316; margin: 1rem 0 0.5rem 0;">üîî Bient√¥t en rupture (${lowStock.length})</h3>
                        ${lowStock.map(item => createInventoryItemHTML(item)).join('')}
                    </div>
                `;
            }

            // Section: Stock OK
            if (goodStock.length > 0) {
                html += `
                    <div class="inventory-section">
                        <h3 class="section-title" style="color: #10b981; margin: 1rem 0 0.5rem 0;">‚úÖ Stock OK (${goodStock.length})</h3>
                        ${goodStock.map(item => createInventoryItemHTML(item)).join('')}
                    </div>
                `;
            }

            container.innerHTML = html;
            updateSuggestions();
        }

        function createInventoryItemHTML(item) {
            const isLow = item.quantity <= item.threshold;
            return `
                <div class="item ${item.zone === 'froid' ? 'item-cold' : 'item-dry'} ${isLow ? 'low-stock-alert' : ''}">
                    <div class="item-content">
                        <div class="item-details">
                            <p class="item-name">${item.name}</p>
                            <p class="item-meta">Seuil: ${item.threshold} ${item.unit || ''}</p>
                            ${isLow ? '<p class="alert-text">‚ö†Ô∏è Stock bas !</p>' : ''}
                        </div>
                        <div class="quantity-controls">
                            <button class="btn-qty" onclick="updateInventoryQuantity('${item.id}', -1)">-</button>
                            <span class="qty-value">${item.quantity || 0} ${item.unit || ''}</span>
                            <button class="btn-qty" onclick="updateInventoryQuantity('${item.id}', 1)">+</button>
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteInventoryItem('${item.id}')">üóëÔ∏è</button>
                </div>
            `;
        }

        function updateSuggestions() {
            const suggestionsContainer = document.getElementById('stockSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');

            // Only show suggestions that aren't already in the shopping list
            const lowStockItems = inventory.filter(inv =>
                inv.quantity <= inv.threshold &&
                !items.some(item => !item.purchased && item.name.toLowerCase() === inv.name.toLowerCase())
            );

            if (lowStockItems.length > 0 && activeTab === 'liste') {
                suggestionsContainer.classList.remove('hidden');
                suggestionsList.innerHTML = lowStockItems.map(item => `
<button class="ingredient-tag" onclick="addItemFromSuggestion('${item.name}')" style="cursor: pointer; background: #fff;">
                        + ${item.name} (${item.quantity})
                    </button>
                `).join('');
            } else {
                suggestionsContainer.classList.add('hidden');
            }
        }

        window.addItemFromSuggestion = async function (itemName) {
            const item = {
                name: itemName,
                zone: determineZone(itemName),
                addedBy: 'Syst√®me (Stock Bas)',
                timestamp: new Date(),
                timestampDisplay: new Date().toLocaleString('fr-FR'),
                purchased: false,
                purchasedBy: null,
                purchasedAt: null
            };

            try {
                await addDoc(collection(db, 'grocery-items'), item);
                console.log('‚úÖ Suggestion ajout√©e');
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        };

        window.addIngredientsToList = async function (recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;

            for (const ingredient of recipe.ingredients) {
                const item = {
                    name: ingredient,
                    zone: determineZone(ingredient),
                    addedBy: userName,
                    timestamp: new Date(),
                    timestampDisplay: new Date().toLocaleString('fr-FR'),
                    purchased: false,
                    purchasedBy: null,
                    purchasedAt: null,
                    fromRecipe: recipe.name
                };

                try {
                    await addDoc(collection(db, 'grocery-items'), item);
                } catch (error) {
                    console.error('‚ùå Erreur:', error);
                }
            }

            switchTab('liste');
        };

        function renderItems() {
            const coldZone = items.filter(i => i.zone === 'froid');
            const dryZone = items.filter(i => i.zone === 'placard');

            document.getElementById('freshCount').textContent = coldZone.length + ' article(s)';
            document.getElementById('secCount').textContent = dryZone.length + ' article(s)';

            const coldContainer = document.getElementById('freshItems');
            const dryContainer = document.getElementById('secItems');

            coldContainer.innerHTML = coldZone.length === 0
                ? '<p class="empty-state">Aucun article</p>'
                : coldZone.map(item => createItemHTML(item, 'cold')).join('');

            dryContainer.innerHTML = dryZone.length === 0
                ? '<p class="empty-state">Aucun article</p>'
                : dryZone.map(item => createItemHTML(item, 'dry')).join('');
        }

        function createItemHTML(item, type) {
            const categoryBadge = item.category && item.category !== 'autre'
                ? `<span class="category-badge category-${item.category}">${categoryIcons[item.category] || 'üì¶'} ${item.category.replace('-', ' ')}</span>`
                : '';
            return `
                <div class="item item-${type} ${item.purchased ? 'item-purchased' : ''}">
                    <div class="item-content">
                        <div class="checkbox ${item.purchased ? 'checkbox-checked' : ''}" onclick="togglePurchased('${item.id}')"></div>
                        <div class="item-details">
                            <p class="item-name ${item.purchased ? 'item-name-purchased' : ''}">
                                ${item.name}
                                ${item.fromRecipe ? `<span class="recipe-badge">üç≥ ${item.fromRecipe}</span>` : ''}
                                ${categoryBadge}
                            </p>
                            <p class="item-meta">Ajout√© par ${item.addedBy} ‚Ä¢ ${item.timestampDisplay}</p>
                            ${item.purchased ? `<p class="purchased-info">‚úì Achet√© par ${item.purchasedBy} le ${item.purchasedAt}</p>` : ''}
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteItem('${item.id}')">üóëÔ∏è</button>
                </div>
            `;
        }

        function renderRecipes() {
            const container = document.getElementById('recipesList');

            if (recipes.length === 0) {
                container.innerHTML = '<p class="empty-state">Aucune recette planifi√©e</p>';
                return;
            }

            container.innerHTML = recipes.map(recipe => `
                <div class="recipe-card">
                    <div class="recipe-header">
                        <div>
                            <h3 class="recipe-name">${recipe.name}</h3>
                            <p class="recipe-meta">Ajout√© par ${recipe.addedBy} ‚Ä¢ ${recipe.timestampDisplay}</p>
                        </div>
                        <button class="btn-delete" onclick="deleteRecipe('${recipe.id}')">üóëÔ∏è</button>
                    </div>
                    <div>
                        <p class="ingredients-label">Ingr√©dients :</p>
                        <div class="ingredients-tags">
                            ${recipe.ingredients.map(ing => `<span class="ingredient-tag">${ing}</span>`).join('')}
                        </div>
                    </div>
                    <button class="btn-add-ingredients" onclick="addIngredientsToList('${recipe.id}')">
                        üõí Ajouter √† la liste de courses
                    </button>
                </div>
            `).join('');
        }

        window.switchTab = function (tab) {
            activeTab = tab;

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => {
                t.classList.remove('active');
                if ((tab === 'liste' && t.textContent.includes('Liste')) ||
                    (tab === 'recettes' && t.textContent.includes('Recettes')) ||
                    (tab === 'inventaire' && t.textContent.includes('Inventaire'))) {
                    t.classList.add('active');
                }
            });

            const addItemForm = document.getElementById('addItemForm');
            const addRecipeForm = document.getElementById('addRecipeForm');
            const addInventoryForm = document.getElementById('addInventoryForm');
            const listeTab = document.getElementById('listeTab');
            const recettesTab = document.getElementById('recettesTab');
            const inventaireTab = document.getElementById('inventaireTab');

            // Reset visibility
            addItemForm.classList.add('hidden');
            addRecipeForm.classList.add('hidden');
            addInventoryForm.classList.add('hidden');
            listeTab.classList.add('hidden');
            recettesTab.classList.add('hidden');
            inventaireTab.classList.add('hidden');

            if (tab === 'liste') {
                addItemForm.classList.remove('hidden');
                listeTab.classList.remove('hidden');
            } else if (tab === 'recettes') {
                addRecipeForm.classList.remove('hidden');
                recettesTab.classList.remove('hidden');
            } else if (tab === 'inventaire') {
                addInventoryForm.classList.remove('hidden');
                inventaireTab.classList.remove('hidden');
            }

            updateSuggestions();
        };

        let currentInventoryFilter = 'all';

        window.filterInventory = function (zone) {
            currentInventoryFilter = zone;

            // Update button states
            document.querySelectorAll('.zone-filter-btn').forEach(btn => btn.classList.remove('active'));
            if (zone === 'all') document.getElementById('filterAll').classList.add('active');
            if (zone === 'frais') document.getElementById('filterFrais').classList.add('active');
            if (zone === 'sec') document.getElementById('filterSec').classList.add('active');

            renderInventory();
        };

        window.selectInventoryZone = function (zone) {
            const fraisBtn = document.getElementById('zoneFraisBtn');
            const secBtn = document.getElementById('zoneSecBtn');

            if (zone === 'frais') {
                fraisBtn.classList.add('active-fresh');
                fraisBtn.classList.remove('active-sec');
                secBtn.classList.remove('active-fresh');
                secBtn.classList.remove('active-sec');
            } else {
                secBtn.classList.add('active-sec');
                secBtn.classList.remove('active-fresh');
                fraisBtn.classList.remove('active-fresh');
                fraisBtn.classList.remove('active-sec');
            }
        };

        document.getElementById('newItem').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.addItem();
        });

        document.getElementById('recipeName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.addRecipe();
        });

        document.getElementById('recipeIngredients').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.addRecipe();
        });

        document.getElementById('newInventoryItem').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.addInventoryItem();
        });

        document.getElementById('inventoryThreshold').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.addInventoryItem();
        });
    </script>

</body>
</html>